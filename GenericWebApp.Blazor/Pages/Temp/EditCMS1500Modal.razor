@using GenericWebApp.DTO.Management
@using GenericWebApp.BLL.Management
@using GenericWebApp.Blazor.Shared.Common
@inject MedicalService myService

@code {
    [Parameter]
    public EventCallback OnCMS1500Saved { get; set; }

    private CMS1500Form cms1500;
    private bool isVisible = false;

    public void Show(CMS1500Form form)
    {
        cms1500 = form;
        isVisible = true;
    }

    private async Task SaveCMS1500()
    {
        if (cms1500 == null) return;

        await myService.SaveItemAsync(cms1500);
        if (myService.Response.ErrorList.Count == 0)
        {
            isVisible = false;
            await OnCMS1500Saved.InvokeAsync();
        }
    }

    private void Cancel()
    {
        isVisible = false;
    }
}

@if (isVisible)
{
    <div class="modal-backdrop">
        <div class="modal show d-block" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit CMS1500 Form</h5>
                        <button type="button" class="btn-close" @onclick="Cancel"></button>
                    </div>
                    <EditForm Model="@cms1500" OnValidSubmit="SaveCMS1500">
                        <div class="modal-body">
                            <DataAnnotationsValidator />
                            <ValidationSummary />

                            <div class="card mb-3">
                                <div class="card-header">
                                    <h5 class="card-title">Claimant Information</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3 form-floating">
                                        <InputText id="claimantName" class="form-control" @bind-Value="cms1500.Claimant.Name" />
                                        <label for="claimantName">Name</label>
                                        <ValidationMessage For="@(() => cms1500.Claimant.Name)" />
                                    </div>
                                    <div class="mb-3 form-floating">
                                        <InputText id="claimantGender" class="form-control" @bind-Value="cms1500.Claimant.Gender" />
                                        <label for="claimantGender">Gender</label>
                                        <ValidationMessage For="@(() => cms1500.Claimant.Gender)" />
                                    </div>
                                    <div class="mb-3 form-floating">
                                        <InputDate id="claimantDOB" class="form-control" @bind-Value="cms1500.Claimant.DateOfBirth" />
                                        <label for="claimantDOB">Date of Birth</label>
                                        <ValidationMessage For="@(() => cms1500.Claimant.DateOfBirth)" />
                                    </div>
                                    <div class="mb-3 form-floating">
                                        <InputText id="insurancePolicyNumber" class="form-control" @bind-Value="cms1500.Claimant.InsurancePolicyNumber" />
                                        <label for="insurancePolicyNumber">Insurance Policy Number</label>
                                        <ValidationMessage For="@(() => cms1500.Claimant.InsurancePolicyNumber)" />
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card mb-3">
                                        <div class="card-header">
                                            <h5 class="card-title">Primary Address</h5>
                                        </div>
                                        <div class="card-body">
                                            <AddressForm Address="@cms1500.Claimant.PrimaryAddress" />
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card mb-3">
                                        <div class="card-header">
                                            <h5 class="card-title">Secondary Address</h5>
                                        </div>
                                        <div class="card-body">
                                            <AddressForm Address="@cms1500.Claimant.SecondaryAddress" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Save</button>
                            <button type="button" class="btn btn-secondary" @onclick="Cancel">Cancel</button>
                        </div>
                    </EditForm>
                </div>
            </div>
        </div>
    </div>
}

<style>
    .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1050;
    }

    .modal-dialog-centered {
        max-width: 80%;
        max-height: 80%; /* Ensure the modal dialog has a max height */
    }

    .modal-content {
        display: flex;
        flex-direction: column;
        max-height: 100%;
        overflow: hidden;
    }

    .modal-body {
        flex: 1 1 auto;
        overflow-y: auto;
        max-height: calc(100vh - 200px); /* Adjust height to leave space for header and footer */
    }

    .modal-footer {
        flex-shrink: 0;
    }
</style>
